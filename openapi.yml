openapi: 3.0.3

info:
  title: Ephemeral Code Execution API
  version: 1.0.0
  description: |
    Stateless execution engine for evaluating user-defined functions
    against visible and hidden test cases.

servers:
  - url: http://localhost:8000
    description: Local development

paths:
  /execute:
    post:
      summary: Execute code against visible test cases
      operationId: executeCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecuteRequest"
      responses:
        "200":
          description: Execution completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExecuteResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /submit:
    post:
      summary: Submit code for evaluation
      operationId: submitCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SubmitRequest"
      responses:
        "200":
          description: Submission evaluated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SubmitResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    ErrorResponse:
      type: object
      required: [status, reason]
      additionalProperties: false
      properties:
        status:
          type: string
        reason:
          type: string
          maxLength: 256

    TestCase:
      type: object
      required: [input]
      additionalProperties: false
      properties:
        input:
          type: object
          additionalProperties: true
        expected_output:
          nullable: true

    ExecuteRequest:
      type: object
      required:
        - language
        - function_name
        - code
        - test_cases
      additionalProperties: false
      properties:
        problem_id:
          type: string
          maxLength: 20000

        language:
          type: string
          enum:
            - python
            - javascript
            - c
            - java
            - kotlin
            - go
            - rust
            - typescript
            - cpp
            - csharp

        function_name:
          type: string
          minLength: 1
          maxLength: 64

        code:
          type: string
          minLength: 1
          maxLength: 5000

        test_cases:
          type: array
          minItems: 1
          maxItems: 20
          items:
            $ref: "#/components/schemas/TestCase"

    ExecuteResult:
      type: object
      required: [input, passed]
      additionalProperties: false
      properties:
        input:
          type: object
          additionalProperties: true
        expected_output:
          nullable: true
        actual_output:
          nullable: true
        passed:
          type: boolean

    ExecuteResponse:
      type: object
      required: [status, results]
      additionalProperties: false
      properties:
        status:
          type: string
          enum: [completed, failed]

        results:
          type: array
          items:
            $ref: "#/components/schemas/ExecuteResult"

        stdout:
          type: string
          maxLength: 1000
          nullable: true

        stderr:
          type: string
          maxLength: 1000
          nullable: true

    SubmitRequest:
      type: object
      required:
        - language
        - function_name
        - code
      additionalProperties: false
      properties:
        problem_id:
          type: string
          maxLength: 64

        language:
          type: string
          enum:
            - python
            - javascript
            - c
            - java
            - kotlin
            - go
            - rust
            - typescript
            - cpp
            - csharp

        function_name:
          type: string
          minLength: 1
          maxLength: 64

        code:
          type: string
          minLength: 1
          maxLength: 5000

    SubmitResponse:
      type: object
      required: [status]
      additionalProperties: false
      properties:
        status:
          type: string
          enum: [completed, failed]
